// Generated by CoffeeScript 1.6.3
(function() {
  'use strict';
  var app;

  app = angular.module('pfather', ['ngRoute']);

  app.controller('MainCtrl', [
    '$scope', '$http', function($scope, $http) {
      var findUser, findUserDetails;
      $scope.step = 1;
      $http.get('/data/users.json').success(function(users) {
        return $scope.users = users;
      });
      $http.get('/data/questions.json').success(function(questions) {
        return $scope.questions = questions;
      });
      findUser = function(id) {
        var fUsers;
        fUsers = $scope.users.filter(function(q) {
          return q.id === id;
        });
        return fUsers[0];
      };
      findUserDetails = function(id) {
        var fUsers;
        fUsers = $scope.questions.filter(function(u) {
          return u.id === id;
        });
        return fUsers[0];
      };
      $scope.showDetails = function(id) {
        var dUsers, findChildren, findParents, user, users;
        console.log(id);
        user = findUser(id);
        users = [];
        findParents = function(user) {
          var parent;
          if (user.parent) {
            parent = findUser(user.parent);
            findParents(parent);
            return users.push(parent);
          }
        };
        findChildren = function(user) {
          var child;
          if (user.child) {
            child = findUser(user.child);
            users.push(child);
            return findChildren(child);
          }
        };
        findParents(user);
        users.push(user);
        findChildren(user);
        console.log(users);
        dUsers = users.map(function(user) {
          return {
            user: user,
            details: findUserDetails(user.id)
          };
        });
        console.log(dUsers);
        $scope.dUsers = dUsers;
        return $scope.step = 2;
      };
      return $scope.toggleStep = function() {
        console.log($scope.step);
        if ($scope.step === 2) {
          return $scope.step = 1;
        } else {
          return $scope.step = 2;
        }
      };
    }
  ]);

}).call(this);
